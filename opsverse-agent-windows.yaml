server:
  # log_level: debug
  http_listen_port: 12347

prometheus:
  global:
    scrape_interval: 30s
  wal_directory: C:\ProgramData\grafana-agent-wal
  configs:
    - name: default
      scrape_configs:
        - job_name: integrations/windows-exporter
          static_configs:
          - targets: ['localhost:9182']
          relabel_configs:
            - source_labels: [__address__]
              regex: '.*'
              target_label: instance
              replacement:  <hostname>
      remote_write:
        - url: https://<vm_hostname>/api/v1/write
          basic_auth:
            username: <username>
            password: <password>

loki:
  positions_directory: C:\ProgramData\grafana-agent-wal
  configs:
    - name: windows-var-log
      clients:
        - url: https://<loki_hostname>/loki/api/v1/push
          basic_auth:
            username: <username>
            password: <password>
      scrape_configs:
        # Add a job for any new dir that needs to be tailed for logs
        - job_name: windows-var-log
          multiline:
            snippet: |
              - multiline:
                  firstline: '^\d{2,4}\-\d{2,4}\-\d{2,4} \d{2,4}\:\d{2,4}\:\d{2,4}\.\d{1,6}'
                  max_lines: 200
          static_configs:
            - labels:
                job: windows-var-log
                host: <host_name> 
                __path__: <log_file_path>
